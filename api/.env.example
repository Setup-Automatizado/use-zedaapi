# ==============================================================================
#  WhatsApp API — Complete Environment Configuration Reference
# ==============================================================================
#  This file documents EVERY environment variable recognized by config.go.
#  Copy to .env, adjust values, and restart the server.
#
#  Duration syntax: Go standard (s, m, h) + custom units (d = days, w = weeks).
#  Examples: 30s, 5m, 2h, 6d, 1w, 720h
# ==============================================================================


# ==============================================================================
#  APPLICATION
# ==============================================================================

# APP_ENV — Runtime environment identifier.
# Used by Sentry (fallback for SENTRY_ENVIRONMENT) and conditional behavior.
# Values: development, staging, production
APP_ENV=development


# ==============================================================================
#  BUILD (Docker only — not read by the Go application)
# ==============================================================================

# TARGETARCH — Target CPU architecture for multi-arch Docker builds.
# Values: amd64, arm64
TARGETARCH=amd64


# ==============================================================================
#  HTTP SERVER
# ==============================================================================

# HTTP_ADDR — Address and port the HTTP server listens on.
# Format: host:port. Use 0.0.0.0 to bind all interfaces.
HTTP_ADDR=0.0.0.0:8080

# API_BASE_URL — Public-facing base URL of this API instance.
# Used to generate absolute URLs in responses (e.g., QR code endpoints).
API_BASE_URL=http://localhost:8080

# HTTP_READ_HEADER_TIMEOUT — Max time to read request headers.
# Protects against slowloris attacks.
HTTP_READ_HEADER_TIMEOUT=5s

# HTTP_READ_TIMEOUT — Max time to read the entire request (headers + body).
HTTP_READ_TIMEOUT=15s

# HTTP_WRITE_TIMEOUT — Max time to write the response.
# Must be >= longest handler execution time.
HTTP_WRITE_TIMEOUT=30s

# HTTP_IDLE_TIMEOUT — Max time to wait for the next request on a keep-alive connection.
HTTP_IDLE_TIMEOUT=120s

# HTTP_MAX_HEADER_BYTES — Maximum size of request headers in bytes.
# Default 1 MB. Prevents memory abuse from oversized headers.
HTTP_MAX_HEADER_BYTES=1048576


# ==============================================================================
#  LOGGING
# ==============================================================================

# LOG_LEVEL — Structured log verbosity (log/slog).
# Values: DEBUG, INFO, WARN, ERROR
LOG_LEVEL=DEBUG


# ==============================================================================
#  POSTGRESQL — Application Database
# ==============================================================================

# POSTGRES_DSN — Connection string for the main application database.
# Stores instances, webhook_configs, event_outbox, message_queue, media_metadata.
POSTGRES_DSN=postgres://funnelchat:funnelchat@localhost:5432/funnelchat_api?sslmode=disable

# POSTGRES_MAX_CONNS — Maximum number of connections in the pgx pool.
# Tune based on expected concurrency and PostgreSQL max_connections.
POSTGRES_MAX_CONNS=32


# ==============================================================================
#  POSTGRESQL — whatsmeow Store
# ==============================================================================

# WAMEOW_POSTGRES_DSN — Connection string for the whatsmeow session/device store.
# Separate database to isolate WhatsApp protocol state from application data.
WAMEOW_POSTGRES_DSN=postgres://funnelchat:funnelchat@localhost:5432/funnelchat_store?sslmode=disable

# WAMEOW_LOG_LEVEL — Log level for whatsmeow internal logs.
# Values: DEBUG, INFO, WARN, ERROR. Empty = INFO.
WAMEOW_LOG_LEVEL=DEBUG


# ==============================================================================
#  REDIS
# ==============================================================================

# REDIS_ADDR — Redis server address.
# Format: host:port
REDIS_ADDR=localhost:6379

# REDIS_USERNAME — Redis ACL username (Redis 6+).
# Leave empty if not using ACL authentication.
REDIS_USERNAME=

# REDIS_PASSWORD — Redis authentication password.
# Leave empty if no password is set.
REDIS_PASSWORD=

# REDIS_DB — Redis database index (0-15).
REDIS_DB=0

# REDIS_TLS_ENABLED — Enable TLS for Redis connections.
# Required for managed Redis services (AWS ElastiCache, Azure Cache, etc.).
REDIS_TLS_ENABLED=false


# ==============================================================================
#  REDIS DISTRIBUTED LOCK
# ==============================================================================

# REDIS_LOCK_KEY_PREFIX — Prefix for all distributed lock keys in Redis.
# Avoids collisions when multiple services share the same Redis instance.
REDIS_LOCK_KEY_PREFIX=funnelchat

# REDIS_LOCK_TTL — Time-to-live for acquired locks.
# Must be long enough for the critical section to complete. Auto-refreshed.
REDIS_LOCK_TTL=30s

# REDIS_LOCK_REFRESH_INTERVAL — How often to refresh the lock TTL.
# Must be less than REDIS_LOCK_TTL. Defaults to TTL/2 if invalid.
REDIS_LOCK_REFRESH_INTERVAL=10s


# ==============================================================================
#  NATS JETSTREAM
# ==============================================================================

# NATS_ENABLED — Feature flag to switch between PostgreSQL polling and NATS pub/sub.
# false = PostgreSQL outbox + LISTEN/NOTIFY + polling (legacy).
# true  = NATS JetStream for message queue, events, media processing.
NATS_ENABLED=false

# NATS_URL — NATS server connection URL.
# Supports comma-separated URLs for cluster: nats://host1:4222,nats://host2:4222
NATS_URL=nats://localhost:4222

# NATS_TOKEN — Authentication token for the NATS server.
# Leave empty if the server does not require authentication.
NATS_TOKEN=

# NATS_CONNECT_TIMEOUT — Maximum time to establish the initial NATS connection.
NATS_CONNECT_TIMEOUT=10s

# NATS_RECONNECT_WAIT — Delay between automatic reconnection attempts.
NATS_RECONNECT_WAIT=2s

# NATS_MAX_RECONNECTS — Maximum number of reconnection attempts.
# -1 = unlimited (recommended for production).
NATS_MAX_RECONNECTS=-1

# NATS_PUBLISH_TIMEOUT — Timeout for JetStream publish operations.
# Covers the round-trip ack from the server.
NATS_PUBLISH_TIMEOUT=5s

# NATS_DRAIN_TIMEOUT — Timeout for graceful NATS drain on shutdown.
# Ensures in-flight messages are processed before disconnecting.
NATS_DRAIN_TIMEOUT=30s


# ==============================================================================
#  S3 / MINIO STORAGE
# ==============================================================================

# S3_ENDPOINT — S3-compatible storage endpoint URL.
# For MinIO local dev: http://localhost:9000
# For AWS S3: leave empty or use regional endpoint.
S3_ENDPOINT=http://minio:9000

# S3_REGION — AWS region for S3 bucket.
S3_REGION=us-east-1

# S3_BUCKET — S3 bucket name for media file storage.
S3_BUCKET=funnelchat-media

# S3_ACCESS_KEY — S3 access key ID.
# For AWS production with IAM Roles: leave empty (SDK auto-discovers credentials).
S3_ACCESS_KEY=funnelchat

# S3_SECRET_KEY — S3 secret access key.
# For AWS production with IAM Roles: leave empty.
S3_SECRET_KEY=funnelchatsecret

# S3_USE_SSL — Enable HTTPS for S3 connections.
# true for AWS S3, false for local MinIO without TLS.
S3_USE_SSL=false

# S3_USE_PRESIGNED_URLS — Controls how media URLs are generated.
# false (recommended) = Clean public URLs without query parameters.
#   Format: {S3_PUBLIC_BASE_URL}/{bucket}/{instance}/{date}/{event}.{ext}
#   Example: http://cdn.example.com/funnelchat-media/uuid/2026/02/15/eventid.ogg
#   Requires: S3_ACL=public-read OR a bucket policy allowing public read.
# true = AWS presigned URLs with expiry tokens (long query strings).
#   Example: http://s3.../eventid.ogg?X-Amz-Algorithm=...&X-Amz-Expires=518400
#   Some platforms may not process URLs with query strings correctly.
S3_USE_PRESIGNED_URLS=false

# S3_PUBLIC_BASE_URL — External base URL for public media access.
# Bucket name is appended automatically: {base_url}/{bucket}/{key}
# Dev (MinIO): http://localhost:9000
# Production: https://cdn.yourdomain.com (CDN / reverse proxy in front of S3)
S3_PUBLIC_BASE_URL=http://minio:9000

# S3_URL_EXPIRATION — Presigned URL expiry duration.
# Only used when S3_USE_PRESIGNED_URLS=true.
S3_URL_EXPIRATION=6d

# S3_MEDIA_RETENTION — How long to keep media files in S3 before cleanup.
S3_MEDIA_RETENTION=720h

# S3_ACL — Object-level ACL applied during upload.
# "public-read" = objects publicly accessible (required when S3_USE_PRESIGNED_URLS=false).
# "" (empty) = use bucket policy instead (modern AWS pattern).
S3_ACL=public-read


# ==============================================================================
#  MEDIA LOCAL STORAGE (fallback when S3 fails)
# ==============================================================================

# MEDIA_LOCAL_STORAGE_PATH — Directory for local media file storage.
MEDIA_LOCAL_STORAGE_PATH=./tmp/media

# MEDIA_LOCAL_URL_EXPIRY — Expiry for local media signed URLs.
MEDIA_LOCAL_URL_EXPIRY=720h

# MEDIA_LOCAL_SECRET_KEY — HMAC secret for signing local media URLs.
MEDIA_LOCAL_SECRET_KEY=supersecret

# MEDIA_LOCAL_PUBLIC_BASE_URL — Public base URL for serving local media files.
MEDIA_LOCAL_PUBLIC_BASE_URL=http://localhost:8080/media

# LOCAL_MEDIA_RETENTION — How long to keep local media files before cleanup.
LOCAL_MEDIA_RETENTION=720h


# ==============================================================================
#  MEDIA CLEANUP
# ==============================================================================

# MEDIA_CLEANUP_INTERVAL — How often the cleanup job runs to remove expired media.
MEDIA_CLEANUP_INTERVAL=168h

# MEDIA_CLEANUP_BATCH_SIZE — Number of expired media files to delete per cleanup run.
MEDIA_CLEANUP_BATCH_SIZE=200


# ==============================================================================
#  DOCUMENT RENDERING
# ==============================================================================

# MUPDF_VERSION — MuPDF library version for PDF/document thumbnail generation.
MUPDF_VERSION=1.24.10


# ==============================================================================
#  SENTRY ERROR TRACKING
# ==============================================================================

# SENTRY_DSN — Sentry Data Source Name for error reporting.
# Leave empty to disable Sentry integration.
SENTRY_DSN=

# SENTRY_ENVIRONMENT — Environment tag sent to Sentry.
# Falls back to APP_ENV if not set.
SENTRY_ENVIRONMENT=local

# SENTRY_RELEASE — Release version tag sent to Sentry.
SENTRY_RELEASE=local-dev


# ==============================================================================
#  WORKERS
# ==============================================================================

# WEBHOOK_DISPATCHER_CONCURRENCY — Number of concurrent webhook delivery workers.
# Higher = faster webhook delivery, but more HTTP connections to partner servers.
WEBHOOK_DISPATCHER_CONCURRENCY=8

# MEDIA_WORKER_CONCURRENCY — Number of concurrent media download/upload workers.
# Each worker handles one media file at a time (download from WhatsApp + upload to S3).
MEDIA_WORKER_CONCURRENCY=4

# WORKER_HEARTBEAT_INTERVAL — How often workers send heartbeat signals.
# Used by the worker registry to detect dead workers.
WORKER_HEARTBEAT_INTERVAL=5s

# WORKER_HEARTBEAT_EXPIRY — Time after which a worker without heartbeat is considered dead.
# Must be > WORKER_HEARTBEAT_INTERVAL. Defaults to 2x interval if invalid.
WORKER_HEARTBEAT_EXPIRY=20s

# WORKER_REBALANCE_INTERVAL — How often to rebalance work across active workers.
# Redistributes instance assignments when workers join or leave.
WORKER_REBALANCE_INTERVAL=30s


# ==============================================================================
#  PROMETHEUS METRICS
# ==============================================================================

# PROMETHEUS_NAMESPACE — Prefix for all Prometheus metric names.
# Metrics exposed at /metrics endpoint. Example: funnelchat_api_media_uploads_total
PROMETHEUS_NAMESPACE=funnelchat_api


# ==============================================================================
#  AUTHENTICATION
# ==============================================================================

# PARTNER_AUTH_TOKEN — Bearer token for partner-level API endpoints.
# Used by external integrations to authenticate.
PARTNER_AUTH_TOKEN=iB4uIxOYOMFSnScXWlphBg==

# CLIENT_AUTH_TOKEN — Global client authentication token.
# REQUIRED: minimum 16 characters. Server refuses to start if missing or too short.
# Used as Bearer token for all client-facing endpoints (/send-*, /instances, etc.).
CLIENT_AUTH_TOKEN=iB4uIxOYOMFSnScXWlphBg==


# ==============================================================================
#  CONTACT METADATA CACHE
# ==============================================================================

# CONTACT_METADATA_CACHE_CAPACITY — Maximum number of contacts to cache in memory.
CONTACT_METADATA_CACHE_CAPACITY=50000

# CONTACT_METADATA_NAME_TTL — How long to cache contact display names.
CONTACT_METADATA_NAME_TTL=24h

# CONTACT_METADATA_PHOTO_TTL — How long to cache contact profile photo URLs.
CONTACT_METADATA_PHOTO_TTL=24h

# CONTACT_METADATA_ERROR_TTL — How long to cache failed contact lookups.
# Prevents hammering WhatsApp servers for contacts that consistently fail.
CONTACT_METADATA_ERROR_TTL=24h

# CONTACT_METADATA_PREFETCH_WORKERS — Number of background workers that prefetch contact info.
CONTACT_METADATA_PREFETCH_WORKERS=4

# CONTACT_METADATA_FETCH_QUEUE_SIZE — Size of the async fetch request queue.
CONTACT_METADATA_FETCH_QUEUE_SIZE=1024


# ==============================================================================
#  EVENT PIPELINE
# ==============================================================================

# EVENT_BUFFER_SIZE — Per-instance in-memory event buffer capacity.
# Events are buffered before batch write to outbox or NATS.
EVENT_BUFFER_SIZE=1000

# EVENT_BATCH_SIZE — Number of events to write per batch (outbox insert or NATS publish).
EVENT_BATCH_SIZE=10

# EVENT_POLL_INTERVAL — How often to poll for new events in the buffer.
EVENT_POLL_INTERVAL=100ms

# EVENT_PROCESSING_TIMEOUT — Max time to process a single event batch.
EVENT_PROCESSING_TIMEOUT=30s

# EVENT_HANDLER_TIMEOUT — Max time for a single event handler (capture callback).
EVENT_HANDLER_TIMEOUT=60s

# EVENT_SHUTDOWN_GRACE_PERIOD — Time to wait for in-flight events to flush on shutdown.
EVENT_SHUTDOWN_GRACE_PERIOD=30s


# ==============================================================================
#  EVENT RETRY
# ==============================================================================

# EVENT_MAX_RETRY_ATTEMPTS — Maximum delivery attempts before sending event to DLQ.
EVENT_MAX_RETRY_ATTEMPTS=6

# EVENT_RETRY_DELAYS — Comma-separated delays between retry attempts.
# Supports Go duration format. Number of values should match max attempts.
EVENT_RETRY_DELAYS=0s,10s,30s,2m,5m,15m


# ==============================================================================
#  CIRCUIT BREAKER
# ==============================================================================

# CB_ENABLED — Enable circuit breaker for webhook delivery.
# Prevents overwhelming failing partner endpoints.
CB_ENABLED=true

# CB_MAX_FAILURES — Number of consecutive failures to trip the circuit breaker.
CB_MAX_FAILURES=5

# CB_TIMEOUT — Duration the circuit stays open (rejecting requests) after tripping.
CB_TIMEOUT=60s

# CB_COOLDOWN — Duration in half-open state before fully closing the circuit.
CB_COOLDOWN=30s


# ==============================================================================
#  DEAD LETTER QUEUE (DLQ)
# ==============================================================================

# DLQ_RETENTION_PERIOD — How long to keep events in the DLQ before purging.
DLQ_RETENTION_PERIOD=7d

# DLQ_REPROCESS_ENABLED — Allow reprocessing of DLQ events.
# When true, failed events can be retried from the DLQ.
DLQ_REPROCESS_ENABLED=true


# ==============================================================================
#  MEDIA PROCESSING
# ==============================================================================

# MEDIA_BUFFER_SIZE — In-memory buffer for pending media tasks.
MEDIA_BUFFER_SIZE=500

# MEDIA_BATCH_SIZE — Number of media tasks to process per batch.
MEDIA_BATCH_SIZE=5

# MEDIA_MAX_RETRIES — Maximum retry attempts for failed media downloads/uploads.
MEDIA_MAX_RETRIES=3

# MEDIA_POLL_INTERVAL — How often to poll for new media tasks.
MEDIA_POLL_INTERVAL=1s

# MEDIA_DOWNLOAD_TIMEOUT — Max time to download a media file from WhatsApp CDN.
MEDIA_DOWNLOAD_TIMEOUT=5m

# MEDIA_UPLOAD_TIMEOUT — Max time to upload a media file to S3/MinIO.
MEDIA_UPLOAD_TIMEOUT=10m

# MEDIA_MAX_FILE_SIZE — Maximum allowed media file size in bytes.
# Default: 104857600 (100 MB). Files exceeding this are rejected.
MEDIA_MAX_FILE_SIZE=104857600

# MEDIA_CHUNK_SIZE — Multipart upload chunk size in bytes.
# Default: 5242880 (5 MB). Used by S3 multipart upload manager.
MEDIA_CHUNK_SIZE=5242880


# ==============================================================================
#  WEBHOOK TRANSPORT
# ==============================================================================

# WEBHOOK_TIMEOUT — HTTP request timeout for webhook delivery to partner endpoints.
WEBHOOK_TIMEOUT=30s

# WEBHOOK_MAX_RETRIES — Maximum retry attempts per webhook delivery.
WEBHOOK_MAX_RETRIES=3

# TRANSPORT_BUFFER_SIZE — Size of the async webhook delivery queue.
TRANSPORT_BUFFER_SIZE=100


# ==============================================================================
#  EVENT CLEANUP
# ==============================================================================

# DELIVERED_RETENTION_PERIOD — How long to keep successfully delivered events in the outbox.
DELIVERED_RETENTION_PERIOD=1d

# CLEANUP_INTERVAL — How often the event cleanup job runs.
CLEANUP_INTERVAL=1h


# ==============================================================================
#  EVENT DEBUG
# ==============================================================================

# EVENTS_DEBUG_RAW_PAYLOAD — Log raw WhatsApp event payloads for debugging.
# WARNING: generates large log volume. Only enable during investigation.
EVENTS_DEBUG_RAW_PAYLOAD=false

# EVENTS_DEBUG_DUMP_DIR — Directory to dump raw event payloads as JSON files.
# Created automatically if it doesn't exist.
EVENTS_DEBUG_DUMP_DIR=./tmp/debug-events


# ==============================================================================
#  MESSAGE QUEUE (outbound /send-* routes)
# ==============================================================================

# MESSAGE_QUEUE_ENABLED — Enable the message queue system.
# CRITICAL: if false, all /send-text, /send-image, /send-document etc. return 404!
MESSAGE_QUEUE_ENABLED=true

# MESSAGE_QUEUE_POLL_INTERVAL — How often to poll for pending messages.
MESSAGE_QUEUE_POLL_INTERVAL=100ms

# MESSAGE_QUEUE_MAX_ATTEMPTS — Max send attempts before moving message to failed.
MESSAGE_QUEUE_MAX_ATTEMPTS=3

# MESSAGE_QUEUE_INITIAL_BACKOFF — Delay after the first send failure.
MESSAGE_QUEUE_INITIAL_BACKOFF=1s

# MESSAGE_QUEUE_MAX_BACKOFF — Maximum delay between retries (caps exponential growth).
MESSAGE_QUEUE_MAX_BACKOFF=5m

# MESSAGE_QUEUE_BACKOFF_MULTIPLIER — Exponential backoff multiplier.
# Delay = INITIAL_BACKOFF * MULTIPLIER^(attempt-1), capped at MAX_BACKOFF.
MESSAGE_QUEUE_BACKOFF_MULTIPLIER=2.0

# MESSAGE_QUEUE_DISCONNECT_RETRY_DELAY — Delay before retrying when WhatsApp is offline.
# Applied when the WhatsApp connection is down (not a send failure).
MESSAGE_QUEUE_DISCONNECT_RETRY_DELAY=30s

# MESSAGE_QUEUE_PROXY_RETRY_DELAY — Delay before retrying when proxy is failing or swapping.
MESSAGE_QUEUE_PROXY_RETRY_DELAY=2m

# MESSAGE_QUEUE_COMPLETED_RETENTION — How long to keep successfully sent messages.
MESSAGE_QUEUE_COMPLETED_RETENTION=24h

# MESSAGE_QUEUE_FAILED_RETENTION — How long to keep permanently failed messages.
MESSAGE_QUEUE_FAILED_RETENTION=7d

# MESSAGE_QUEUE_CLEANUP_INTERVAL — How often the message cleanup job runs.
MESSAGE_QUEUE_CLEANUP_INTERVAL=1h

# MESSAGE_QUEUE_CLEANUP_TIMEOUT — Timeout for the cleanup job (stuck message detection).
MESSAGE_QUEUE_CLEANUP_TIMEOUT=5m


# ==============================================================================
#  RECONCILIATION
# ==============================================================================

# RECONCILIATION_ENABLED — Enable periodic reconciliation of instance states.
# Detects and recovers from inconsistencies between database and runtime state.
RECONCILIATION_ENABLED=true

# RECONCILIATION_INTERVAL — How often reconciliation checks run.
RECONCILIATION_INTERVAL=10s


# ==============================================================================
#  AUTO-CONNECT
# ==============================================================================

# AUTO_CONNECT_PAIRED — Automatically connect all previously paired WhatsApp instances on startup.
AUTO_CONNECT_PAIRED=true

# AUTO_CONNECT_MAX_ATTEMPTS — Maximum connection attempts per instance during auto-connect.
AUTO_CONNECT_MAX_ATTEMPTS=3

# AUTO_CONNECT_INITIAL_BACKOFF — Delay after the first failed connection attempt.
AUTO_CONNECT_INITIAL_BACKOFF=1s

# AUTO_CONNECT_MAX_BACKOFF — Maximum delay between connection retry attempts.
AUTO_CONNECT_MAX_BACKOFF=10s


# ==============================================================================
#  SHUTDOWN TIMEOUTS
# ==============================================================================

# SHUTDOWN_TIMEOUT — Overall maximum time for graceful shutdown.
# If this expires, the process is forcefully terminated.
SHUTDOWN_TIMEOUT=120s

# SHUTDOWN_HTTP_TIMEOUT — Max time to wait for HTTP server to stop accepting new requests.
SHUTDOWN_HTTP_TIMEOUT=30s

# SHUTDOWN_QUEUE_TIMEOUT — Max time to drain the message queue on shutdown.
SHUTDOWN_QUEUE_TIMEOUT=60s

# SHUTDOWN_EVENT_TIMEOUT — Max time to flush pending events on shutdown.
SHUTDOWN_EVENT_TIMEOUT=10s

# SHUTDOWN_CLIENT_TIMEOUT — Max time to disconnect all WhatsApp clients on shutdown.
SHUTDOWN_CLIENT_TIMEOUT=10s

# SHUTDOWN_LOCK_TIMEOUT — Max time to release distributed locks on shutdown.
SHUTDOWN_LOCK_TIMEOUT=5s


# ==============================================================================
#  STATUS CACHE (Redis deduplication for receipt webhooks)
# ==============================================================================

# STATUS_CACHE_ENABLED — Enable Redis-based status caching to reduce webhook noise.
# When enabled, duplicate status updates are cached and suppressed based on TTL/scope.
STATUS_CACHE_ENABLED=true

# STATUS_CACHE_TTL — Time-to-live for cached status entries.
STATUS_CACHE_TTL=24h

# STATUS_CACHE_TYPES — Comma-separated list of status types to deduplicate.
# Available: read, delivered, played, sent
STATUS_CACHE_TYPES=read,delivered,played,sent

# STATUS_CACHE_SCOPE — Comma-separated list of chat scopes to apply caching.
# Available: groups (group chats), direct (1:1 private chats)
STATUS_CACHE_SCOPE=groups

# STATUS_CACHE_SUPPRESS_WEBHOOKS — Suppress webhook delivery for cached (duplicate) statuses.
STATUS_CACHE_SUPPRESS_WEBHOOKS=true

# STATUS_CACHE_FLUSH_BATCH_SIZE — Number of entries to flush per single batch operation.
STATUS_CACHE_FLUSH_BATCH_SIZE=100

# STATUS_CACHE_CLEANUP_INTERVAL — How often to clean up expired cache entries.
STATUS_CACHE_CLEANUP_INTERVAL=1h

# STATUS_CACHE_OPERATION_TIMEOUT — Timeout for individual Redis operations (get, set, flush).
STATUS_CACHE_OPERATION_TIMEOUT=10s


# ==============================================================================
#  API ECHO
# ==============================================================================

# API_ECHO_ENABLED — Enable webhook dispatch for messages sent via the API.
# When true, messages sent through /send-* routes generate webhooks with
# fromMe=true and fromApi=true, so the webhook receiver can track API-sent messages.
API_ECHO_ENABLED=true


# ==============================================================================
#  EVENT FILTERS
# ==============================================================================

# FILTER_WAITING_MESSAGE — Filter out events with waitingMessage=true.
# These are incomplete messages still awaiting sender key distribution from WhatsApp.
# Recommended: true (prevents delivering partial/unreadable messages to webhooks).
FILTER_WAITING_MESSAGE=true

# FILTER_SECONDARY_DEVICE_RECEIPTS — Filter out receipts from secondary devices.
# WhatsApp multi-device sends receipts from every linked device (Device > 0).
# Recommended: true (keeps only primary device receipts, avoids duplicates).
FILTER_SECONDARY_DEVICE_RECEIPTS=true


# ==============================================================================
#  PROXY HEALTH CHECK
# ==============================================================================

# PROXY_HEALTH_CHECK_INTERVAL — How often to check if assigned proxies are healthy.
PROXY_HEALTH_CHECK_INTERVAL=60s

# PROXY_HEALTH_CHECK_TIMEOUT — Timeout for each individual health check request.
PROXY_HEALTH_CHECK_TIMEOUT=10s

# PROXY_MAX_CONSECUTIVE_FAILURES — Number of consecutive health check failures
# before marking a proxy as unhealthy.
PROXY_MAX_CONSECUTIVE_FAILURES=3

# PROXY_DLQ_ON_UNHEALTHY — Route messages to DLQ when the assigned proxy is unhealthy.
# Prevents repeated send failures against a dead proxy.
PROXY_DLQ_ON_UNHEALTHY=true

# PROXY_PAUSE_QUEUE_ON_UNHEALTHY — Pause message queue processing when proxy is unhealthy.
# Messages remain queued and resume when the proxy recovers.
PROXY_PAUSE_QUEUE_ON_UNHEALTHY=true

# PROXY_LOG_RETENTION_PERIOD — How long to keep proxy health check logs.
PROXY_LOG_RETENTION_PERIOD=168h

# PROXY_CLEANUP_INTERVAL — How often to clean up old proxy health check logs.
PROXY_CLEANUP_INTERVAL=1h


# ==============================================================================
#  PROXY POOL (Webshare Integration)
# ==============================================================================

# PROXY_POOL_ENABLED — Enable automatic proxy pool management via Webshare API.
# When enabled, proxies are synced from Webshare and auto-assigned to instances.
PROXY_POOL_ENABLED=false

# PROXY_POOL_SYNC_INTERVAL — How often to sync the proxy list from Webshare API.
PROXY_POOL_SYNC_INTERVAL=15m

# PROXY_POOL_DEFAULT_COUNTRY_CODES — Comma-separated ISO country codes for proxy selection.
# Proxies matching these countries are preferred during assignment.
PROXY_POOL_DEFAULT_COUNTRY_CODES=BR,AR,CL,CO,MX,PE,EC,UY,PY,BO,VE,US,CA

# PROXY_POOL_ASSIGNMENT_RETRY_DELAY — Delay between proxy assignment retry attempts.
PROXY_POOL_ASSIGNMENT_RETRY_DELAY=5s

# PROXY_POOL_MAX_ASSIGNMENT_RETRIES — Maximum number of proxy assignment attempts.
PROXY_POOL_MAX_ASSIGNMENT_RETRIES=3

# PROXY_POOL_WEBSHARE_API_KEY — Webshare API authentication token.
# Get yours at: https://proxy.webshare.io/
PROXY_POOL_WEBSHARE_API_KEY=

# PROXY_POOL_WEBSHARE_ENDPOINT — Webshare API base URL.
PROXY_POOL_WEBSHARE_ENDPOINT=https://proxy.webshare.io/api/v2

# PROXY_POOL_WEBSHARE_PLAN_ID — Webshare subscription plan ID.
# Required to target a specific proxy type (ISP/static vs rotating residential).
# Find yours: curl -s "https://proxy.webshare.io/api/v2/subscription/plan/" \
#   -H "Authorization: Token YOUR_API_KEY"
PROXY_POOL_WEBSHARE_PLAN_ID=

# PROXY_POOL_WEBSHARE_MODE — Webshare connection mode.
# "direct"   = Static Residential / ISP (dedicated IPs, real ports, best for WhatsApp)
# "backbone" = Rotating Residential (shared backbone via p.webshare.io)
PROXY_POOL_WEBSHARE_MODE=direct
