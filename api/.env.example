# ==================================================
# WhatsApp API - Environment Configuration
# ==================================================
# This file contains ALL environment variables
# supported by config.go. Copy to .env and adjust.
# ==================================================

# --------------------------------------------------
# Build Configuration
# --------------------------------------------------
TARGETARCH=amd64

# --------------------------------------------------
# Application Environment
# --------------------------------------------------
APP_ENV=development

# --------------------------------------------------
# HTTP Server Configuration
# --------------------------------------------------
HTTP_ADDR=0.0.0.0:8080
API_BASE_URL=http://localhost:8080
HTTP_READ_HEADER_TIMEOUT=5s
HTTP_READ_TIMEOUT=15s
HTTP_WRITE_TIMEOUT=30s
HTTP_IDLE_TIMEOUT=120s
HTTP_MAX_HEADER_BYTES=1048576

# --------------------------------------------------
# Logging Configuration
# --------------------------------------------------
LOG_LEVEL=DEBUG

# --------------------------------------------------
# PostgreSQL Configuration (Application Database)
# --------------------------------------------------
POSTGRES_DSN=postgres://funnelchat:funnelchat@localhost:5432/funnelchat_api?sslmode=disable
POSTGRES_MAX_CONNS=32

# --------------------------------------------------
# WhatsApp Store Database (whatsmeow)
# --------------------------------------------------
WAMEOW_POSTGRES_DSN=postgres://funnelchat:funnelchat@localhost:5432/funnelchat_store?sslmode=disable
WAMEOW_LOG_LEVEL=DEBUG

# --------------------------------------------------
# Redis Configuration
# --------------------------------------------------
REDIS_ADDR=localhost:6379
REDIS_USERNAME=
REDIS_PASSWORD=
REDIS_DB=0
REDIS_TLS_ENABLED=false

# --------------------------------------------------
# Redis Lock Configuration
# --------------------------------------------------
REDIS_LOCK_KEY_PREFIX=funnelchat
REDIS_LOCK_TTL=30s
REDIS_LOCK_REFRESH_INTERVAL=10s

# --------------------------------------------------
# S3/MinIO Storage Configuration
# --------------------------------------------------
S3_ENDPOINT=http://minio:9000
S3_REGION=us-east-1
S3_BUCKET=funnelchat-media
S3_ACCESS_KEY=funnelchat
S3_SECRET_KEY=funnelchatsecret
S3_USE_SSL=false
S3_USE_PRESIGNED_URLS=true
S3_PUBLIC_BASE_URL=http://minio:9000
S3_URL_EXPIRATION=6d
S3_MEDIA_RETENTION=720h
# Optional: S3 object ACL (e.g., "public-read", "private"). Empty = use bucket policy
S3_ACL=

# --------------------------------------------------
# Media Local Storage Configuration (fallback when S3 fails)
# --------------------------------------------------
MEDIA_LOCAL_STORAGE_PATH=./tmp/media
MEDIA_LOCAL_URL_EXPIRY=720h
MEDIA_LOCAL_SECRET_KEY=supersecret
MEDIA_LOCAL_PUBLIC_BASE_URL=http://localhost:8080/media
LOCAL_MEDIA_RETENTION=720h

# --------------------------------------------------
# Media Cleanup Configuration
# --------------------------------------------------
MEDIA_CLEANUP_INTERVAL=168h
MEDIA_CLEANUP_BATCH_SIZE=200

# --------------------------------------------------
# Document Rendering (MuPDF bindings)
# --------------------------------------------------
MUPDF_VERSION=1.24.10

# --------------------------------------------------
# Sentry Error Tracking
# --------------------------------------------------
SENTRY_DSN=
SENTRY_ENVIRONMENT=local
SENTRY_RELEASE=local-dev

# --------------------------------------------------
# Worker Configuration
# --------------------------------------------------
WEBHOOK_DISPATCHER_CONCURRENCY=8
MEDIA_WORKER_CONCURRENCY=4
WORKER_HEARTBEAT_INTERVAL=5s
WORKER_HEARTBEAT_EXPIRY=20s
WORKER_REBALANCE_INTERVAL=30s

# --------------------------------------------------
# Prometheus Metrics
# --------------------------------------------------
PROMETHEUS_NAMESPACE=funnelchat_api

# --------------------------------------------------
# Authentication Tokens
# --------------------------------------------------
# PARTNER_AUTH_TOKEN: Token for partner authentication (Bearer token)
PARTNER_AUTH_TOKEN=iB4uIxOYOMFSnScXWlphBg==
# CLIENT_AUTH_TOKEN: Global client token (minimum 16 characters, required)
CLIENT_AUTH_TOKEN=iB4uIxOYOMFSnScXWlphBg==

# --------------------------------------------------
# Contact Metadata Cache Configuration
# --------------------------------------------------
CONTACT_METADATA_CACHE_CAPACITY=50000
CONTACT_METADATA_NAME_TTL=24h
CONTACT_METADATA_PHOTO_TTL=24h
CONTACT_METADATA_ERROR_TTL=24h
CONTACT_METADATA_PREFETCH_WORKERS=4
CONTACT_METADATA_FETCH_QUEUE_SIZE=1024

# --------------------------------------------------
# Event System Configuration
# --------------------------------------------------
EVENT_BUFFER_SIZE=1000
EVENT_BATCH_SIZE=10
EVENT_POLL_INTERVAL=100ms
EVENT_PROCESSING_TIMEOUT=30s
EVENT_HANDLER_TIMEOUT=60s
EVENT_SHUTDOWN_GRACE_PERIOD=30s

# --------------------------------------------------
# Event Retry Configuration
# --------------------------------------------------
EVENT_MAX_RETRY_ATTEMPTS=6
EVENT_RETRY_DELAYS=0s,10s,30s,2m,5m,15m

# --------------------------------------------------
# Circuit Breaker Configuration
# --------------------------------------------------
CB_ENABLED=true
CB_MAX_FAILURES=5
CB_TIMEOUT=60s
CB_COOLDOWN=30s

# --------------------------------------------------
# DLQ (Dead Letter Queue) Configuration
# --------------------------------------------------
DLQ_RETENTION_PERIOD=7d
DLQ_REPROCESS_ENABLED=true

# --------------------------------------------------
# Media Processing Configuration
# --------------------------------------------------
MEDIA_BUFFER_SIZE=500
MEDIA_BATCH_SIZE=5
MEDIA_MAX_RETRIES=3
MEDIA_POLL_INTERVAL=1s
MEDIA_DOWNLOAD_TIMEOUT=5m
MEDIA_UPLOAD_TIMEOUT=10m
MEDIA_MAX_FILE_SIZE=104857600
MEDIA_CHUNK_SIZE=5242880

# --------------------------------------------------
# Webhook Transport Configuration
# --------------------------------------------------
WEBHOOK_TIMEOUT=30s
WEBHOOK_MAX_RETRIES=3
TRANSPORT_BUFFER_SIZE=100

# --------------------------------------------------
# Event Cleanup Configuration
# --------------------------------------------------
DELIVERED_RETENTION_PERIOD=1d
CLEANUP_INTERVAL=1h

# --------------------------------------------------
# Event Debug Configuration
# --------------------------------------------------
EVENTS_DEBUG_RAW_PAYLOAD=false
EVENTS_DEBUG_DUMP_DIR=./tmp/debug-events

# --------------------------------------------------
# Message Queue Configuration (CRITICAL for /send-* routes)
# --------------------------------------------------
# MESSAGE_QUEUE_ENABLED: Enables message queue system and /send-* routes
# IMPORTANT: If false, routes /send-text, /send-image, etc. will return 404!
MESSAGE_QUEUE_ENABLED=true
MESSAGE_QUEUE_POLL_INTERVAL=100ms
MESSAGE_QUEUE_MAX_ATTEMPTS=3
MESSAGE_QUEUE_INITIAL_BACKOFF=1s
MESSAGE_QUEUE_MAX_BACKOFF=5m
MESSAGE_QUEUE_BACKOFF_MULTIPLIER=2.0
MESSAGE_QUEUE_DISCONNECT_RETRY_DELAY=30s
MESSAGE_QUEUE_PROXY_RETRY_DELAY=2m
MESSAGE_QUEUE_COMPLETED_RETENTION=24h
MESSAGE_QUEUE_FAILED_RETENTION=7d
MESSAGE_QUEUE_CLEANUP_INTERVAL=1h
MESSAGE_QUEUE_CLEANUP_TIMEOUT=5m

# --------------------------------------------------
# Reconciliation Configuration
# --------------------------------------------------
RECONCILIATION_ENABLED=true
RECONCILIATION_INTERVAL=10s

# --------------------------------------------------
# Auto-Connect Configuration
# --------------------------------------------------
AUTO_CONNECT_PAIRED=true
AUTO_CONNECT_MAX_ATTEMPTS=3
AUTO_CONNECT_INITIAL_BACKOFF=1s
AUTO_CONNECT_MAX_BACKOFF=10s

# --------------------------------------------------
# Shutdown Configuration
# --------------------------------------------------
SHUTDOWN_TIMEOUT=120s
SHUTDOWN_HTTP_TIMEOUT=30s
SHUTDOWN_QUEUE_TIMEOUT=60s
SHUTDOWN_EVENT_TIMEOUT=10s
SHUTDOWN_CLIENT_TIMEOUT=10s
SHUTDOWN_LOCK_TIMEOUT=5s

# --------------------------------------------------
# Status Cache Configuration
# --------------------------------------------------
# STATUS_CACHE_ENABLED: Enables Redis-based status caching to reduce webhook noise
# When enabled, duplicate status updates (read, delivered, played, sent) are
# cached and suppressed based on TTL and scope settings.
STATUS_CACHE_ENABLED=true
# STATUS_CACHE_TTL: Time-to-live for cached status entries
STATUS_CACHE_TTL=24h
# STATUS_CACHE_TYPES: Comma-separated list of status types to cache
# Available types: read, delivered, played, sent
STATUS_CACHE_TYPES=read,delivered,played,sent
# STATUS_CACHE_SCOPE: Comma-separated list of chat scopes to apply caching
# Available scopes: groups, direct (direct = 1:1 chats)
STATUS_CACHE_SCOPE=groups
# STATUS_CACHE_SUPPRESS_WEBHOOKS: Suppress webhook delivery for cached duplicates
STATUS_CACHE_SUPPRESS_WEBHOOKS=true
# STATUS_CACHE_FLUSH_BATCH_SIZE: Number of entries to flush in single batch operation
STATUS_CACHE_FLUSH_BATCH_SIZE=100
# STATUS_CACHE_CLEANUP_INTERVAL: Interval for automatic cleanup of expired entries
STATUS_CACHE_CLEANUP_INTERVAL=1h
# STATUS_CACHE_OPERATION_TIMEOUT: Timeout for Redis operations (get, set, flush)
STATUS_CACHE_OPERATION_TIMEOUT=10s

# --------------------------------------------------
# Proxy Pool Configuration (Webshare Integration)
# --------------------------------------------------
# PROXY_POOL_ENABLED: Enable the proxy pool system for automatic proxy management
PROXY_POOL_ENABLED=false
# PROXY_POOL_SYNC_INTERVAL: How often to sync proxies from the provider
PROXY_POOL_SYNC_INTERVAL=5m
# PROXY_POOL_DEFAULT_COUNTRY_CODES: Comma-separated ISO country codes for proxy selection
PROXY_POOL_DEFAULT_COUNTRY_CODES=BR,AR,CL,CO,MX,PE,EC,UY,PY,BO,VE,US,CA
# PROXY_POOL_ASSIGNMENT_RETRY_DELAY: Delay between assignment retry attempts
PROXY_POOL_ASSIGNMENT_RETRY_DELAY=5s
# PROXY_POOL_MAX_ASSIGNMENT_RETRIES: Maximum number of assignment attempts
PROXY_POOL_MAX_ASSIGNMENT_RETRIES=3
# PROXY_POOL_WEBSHARE_API_KEY: Webshare API authentication token
PROXY_POOL_WEBSHARE_API_KEY=
# PROXY_POOL_WEBSHARE_ENDPOINT: Webshare API base URL
PROXY_POOL_WEBSHARE_ENDPOINT=https://proxy.webshare.io/api/v2
# PROXY_POOL_WEBSHARE_PLAN_ID: Webshare subscription plan ID (use API to list plans)
# Required to target specific proxy type (ISP/static vs rotating residential)
# Find your plan ID: curl -s "https://proxy.webshare.io/api/v2/subscription/plan/" -H "Authorization: Token YOUR_API_KEY"
PROXY_POOL_WEBSHARE_PLAN_ID=
# PROXY_POOL_WEBSHARE_MODE: Webshare connection mode
# "direct" = Static Residential / ISP (dedicated IPs, real ports)
# "backbone" = Rotating Residential (shared backbone via p.webshare.io)
PROXY_POOL_WEBSHARE_MODE=direct
