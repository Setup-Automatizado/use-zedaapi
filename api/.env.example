TARGETARCH=arm64

APP_ENV=development
HTTP_ADDR=0.0.0.0:8080
API_BASE_URL=https://go.setupautomatizado.com
HTTP_READ_HEADER_TIMEOUT=5s
HTTP_READ_TIMEOUT=15s
HTTP_WRITE_TIMEOUT=30s
HTTP_IDLE_TIMEOUT=120s
HTTP_MAX_HEADER_BYTES=1048576

LOG_LEVEL=DEBUG

POSTGRES_DSN=postgres://funnelchat:funnelchat@localhost:5432/funnelchat_api?sslmode=disable
POSTGRES_MAX_CONNS=32

WAMEOW_POSTGRES_DSN=postgres://funnelchat:funnelchat@localhost:5432/funnelchat_store?sslmode=disable
WAMEOW_LOG_LEVEL=DEBUG

REDIS_ADDR=localhost:6379
REDIS_USERNAME=
REDIS_PASSWORD=
REDIS_DB=0
REDIS_TLS_ENABLED=false
REDIS_LOCK_KEY_PREFIX=funnelchat
REDIS_LOCK_TTL=30s
REDIS_LOCK_REFRESH_INTERVAL=10s

S3_ENDPOINT=http://minio:9000
S3_REGION=us-east-1
S3_BUCKET=funnelchat-media
S3_ACCESS_KEY=funnelchat
S3_SECRET_KEY=funnelchatsecret
S3_USE_SSL=false
S3_USE_PRESIGNED_URLS=true
# Optional: override the base URL used when S3_USE_PRESIGNED_URLS=false (include bucket prefix if required)
S3_PUBLIC_BASE_URL=http://minio:9000
S3_URL_EXPIRATION=30d

MEDIA_CLEANUP_INTERVAL=168h
MEDIA_CLEANUP_BATCH_SIZE=200
S3_MEDIA_RETENTION=720h
LOCAL_MEDIA_RETENTION=720h

# Media Local Storage Configuration (fallback when S3 fails)
MEDIA_LOCAL_STORAGE_PATH=./tmp/media
MEDIA_LOCAL_URL_EXPIRY=720h
MEDIA_LOCAL_SECRET_KEY=supersecret
MEDIA_LOCAL_PUBLIC_BASE_URL=http://localhost:8080/media

# Document rendering (MuPDF bindings)
MUPDF_VERSION=1.24.10


SENTRY_DSN=https://7025dfb99143d83ce06fb5ca8ad4fcd7@o4508841171288064.ingest.us.sentry.io/4510013579657216
SENTRY_ENVIRONMENT=local
SENTRY_RELEASE=local-dev

WEBHOOK_DISPATCHER_CONCURRENCY=8
MEDIA_WORKER_CONCURRENCY=4
WORKER_HEARTBEAT_INTERVAL=5s
WORKER_HEARTBEAT_EXPIRY=20s
WORKER_REBALANCE_INTERVAL=30s

PROMETHEUS_NAMESPACE=funnelchat_api

# Partner authentication (for /instances/integrator/* routes)
PARTNER_AUTH_TOKEN=replace-me

# Client authentication (global token for all instance routes)
# This single token is used for authentication across ALL instances
# Replaces the old per-instance client_token approach
CLIENT_AUTH_TOKEN=replace-me-with-secure-token

# Contact metadata cache configuration
CONTACT_METADATA_CACHE_CAPACITY=50000
CONTACT_METADATA_NAME_TTL=24h
CONTACT_METADATA_PHOTO_TTL=24h
CONTACT_METADATA_ERROR_TTL=24h
CONTACT_METADATA_PREFETCH_WORKERS=4
CONTACT_METADATA_FETCH_QUEUE_SIZE=1024

# Event System Configuration
EVENT_BUFFER_SIZE=1000
EVENT_BATCH_SIZE=10
EVENT_POLL_INTERVAL=100ms
EVENT_PROCESSING_TIMEOUT=30s
EVENT_HANDLER_TIMEOUT=60s
EVENT_SHUTDOWN_GRACE_PERIOD=30s

# Event Retry Configuration
EVENT_MAX_RETRY_ATTEMPTS=6
EVENT_RETRY_DELAYS=0s,10s,30s,2m,5m,15m

# Circuit Breaker Configuration
CB_ENABLED=true
CB_MAX_FAILURES=5
CB_TIMEOUT=60s
CB_COOLDOWN=30s

# DLQ Configuration
DLQ_RETENTION_PERIOD=7d
DLQ_REPROCESS_ENABLED=true

# Media Processing Configuration
MEDIA_BUFFER_SIZE=500
MEDIA_BATCH_SIZE=5
MEDIA_MAX_RETRIES=3
MEDIA_POLL_INTERVAL=1s
MEDIA_DOWNLOAD_TIMEOUT=5m
MEDIA_UPLOAD_TIMEOUT=10m
MEDIA_MAX_FILE_SIZE=104857600
MEDIA_CHUNK_SIZE=5242880

# Webhook Transport Configuration
WEBHOOK_TIMEOUT=30s
WEBHOOK_MAX_RETRIES=3
TRANSPORT_BUFFER_SIZE=100

# Event Cleanup Configuration
DELIVERED_RETENTION_PERIOD=1d
CLEANUP_INTERVAL=1h

EVENTS_DEBUG_RAW_PAYLOAD=false
EVENTS_DEBUG_DUMP_DIR=./tmp/debug-events

MESSAGE_QUEUE_POLL_INTERVAL=1s           # Frequência de polling
MESSAGE_QUEUE_MAX_ATTEMPTS=3             # Tentativas antes de DLQ
MESSAGE_QUEUE_INITIAL_BACKOFF=5s         # Delay inicial após falha
MESSAGE_QUEUE_MAX_BACKOFF=5m             # Delay máximo
MESSAGE_QUEUE_BACKOFF_MULTIPLIER=2.0     # Taxa de crescimento exponencial
MESSAGE_QUEUE_DISCONNECT_RETRY_DELAY=30s # Delay quando WhatsApp offline
MESSAGE_QUEUE_COMPLETED_RETENTION=24h    # Tempo manter mensagens ok
MESSAGE_QUEUE_FAILED_RETENTION=168h      # Tempo manter falhas (7d)
MESSAGE_QUEUE_CLEANUP_INTERVAL=1h        # Frequência cleanup job
MESSAGE_QUEUE_CLEANUP_TIMEOUT=5m         # Timeout para stuck messages
